<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
<th:block th:include="include :: header('修改经营部投标申请')" />
<th:block th:include="include :: bootstrap-fileinput-css" />
</head>
<body class="white-bg">
	<div class="wrapper wrapper-content animated fadeInRight ibox-content">
		<form class="form-horizontal m" id="form-jyTender-edit"
			th:object="${jyTender}">
			<input id="id" name="id" th:field="*{id}" type="hidden">
			<input id="ytApply" name="ytApply" th:field="*{ytApply}" type="hidden">
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">申请公司：</label>
					<div class="col-sm-8">
						<input type="hidden" name="companyId" id="companyId"
							   th:value="*{companyId}"/>
						<input type="text" id="companyName" name="companyName" class="form-control"
							   onclick="selectDeptTree('companyId','companyName','0')"
							   th:value="*{companyName}"/>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">申请部门：</label>
					<div class="col-sm-8">
						<input type="hidden" name="deptId" id="treeId"
							   th:value="*{deptId}"/>
						<input type="text" id="treeName" name="deptName" class="form-control"
							   onclick="selectDeptTree('treeId','treeName','1')"
							   th:value="*{deptName}"/>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">投标方式：</label>
					<div class="col-sm-8">
						<select id="tenderType" th:field="*{tenderType}" name="tenderType"
							class="form-control"
							th:with="type=${@dict.getType('business_project_type')}">
							<option value="">------所有------</option>
							<option th:each="dict : ${type}" th:text="${dict.dictLabel}"
								th:value="${dict.dictValue}"></option>
						</select>

					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">工程类型：</label>
					<div class="col-sm-8">
						<select id="proType" name="proType" th:field="*{proType}"
							class="form-control"
							th:with="type=${@dict.getType('business_engineer_type')}">
							<option value="">------所有------</option>
							<option th:each="dict : ${type}" th:text="${dict.dictLabel}"
								th:value="${dict.dictValue}"></option>
						</select>

					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">开标时间：</label>
					<div class="col-sm-8">
						<input id="openTenderDate" name="openTenderDate"  class="form-control time-input-data"
							type="text" th:value="${#dates.format(jyTender.openTenderDate, 'yyyy-MM-dd')}">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">工程造价：</label>
					<div class="col-sm-8">
						<input id="amount" name="amount" th:field="*{amount}"
							class="form-control" type="number">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">暂定投标费：</label>
					<div class="col-sm-8">
						<input id="tenderCostTemp" name="tenderCostTemp"
							th:field="*{tenderCostTemp}" class="form-control" type="number">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">已收款：</label>
					<div class="col-sm-8">
						<input id="payAlready" name="payAlready" th:field="*{payAlready}"
							class="form-control" type="number">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">未收款：</label>
					<div class="col-sm-8">
						<input id="unpayMoney" name="unpayMoney" th:field="*{unpayMoney}"
							class="form-control" type="number">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">已汇保证金：</label>
					<div class="col-sm-8">
						<select id="depositAlready" th:field="*{depositAlready}"
							name="depositAlready" class="form-control"
							th:with="type=${@dict.getType('sys_yes_no')}">
							<option value="">------所有------</option>
							<option th:each="dict : ${type}" th:text="${dict.dictLabel}"
								th:value="${dict.dictValue}"></option>
						</select>

					</div>
				</div>
			</div>
			<!-- <div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">状态：</label>
					<div class="col-sm-8">
						<input id="status" name="status" th:field="*{status}"
							class="form-control" type="text">
					</div>
				</div>
			</div> -->
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">流程id：</label>
					<div class="col-sm-8">
						<input id="procInstId" name="procInstId" th:field="*{procInstId}"
							class="form-control" type="text" readonly>
					</div>
				</div>
			</div>

			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">招标公告网址：</label>
					<div class="col-sm-8">
						<input id="tenderUrl" name="tenderUrl" th:field="*{tenderUrl}"
							class="form-control" type="text">
					</div>
				</div>
			</div>
			
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">资质要求：</label>
					<div class="col-sm-8">
						<input id="qualifications" name="qualifications"
							th:field="*{qualifications}" class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">业绩要求：</label>
					<div class="col-sm-8">
						<input id="kpiRequire" name="kpiRequire" th:field="*{kpiRequire}"
							class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">其他要求：</label>
					<div class="col-sm-8">
						<input id="otherRequire" name="otherRequire"
							th:field="*{otherRequire}" class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">合作伙伴：</label>
					<div class="col-sm-8">
						<input id="partners" name="partners" th:field="*{partners}"
							class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">编号：</label>
					<div class="col-sm-8">
						<input id="code" name="code" th:field="*{code}"
							class="form-control" type="text" readonly>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">备注：</label>
					<div class="col-sm-8">
						<input id="remark" name="remark" th:field="*{remark}"
							class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">工期：</label>
					<div class="col-sm-8">
						<input id="timeLimit" name="timeLimit" th:field="*{timeLimit}"
							class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">建设单位：</label>
					<div class="col-sm-8">
						<input id="constructUnit" name="constructUnit"
							th:field="*{constructUnit}" class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">保证金金额：</label>
					<div class="col-sm-8">
						<input id="promiseMoney" name="promiseMoney"
							th:field="*{promiseMoney}" class="form-control" type="number">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">建造师：</label>
					<div class="col-sm-8">
						<input id="builderName" name="builderName"
							th:field="*{builderName}" class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">工程概况：</label>
					<div class="col-sm-8">
						<input id="projectDesc" name="projectDesc"
							th:field="*{projectDesc}" class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label class="col-sm-4 control-label">工程名称：</label>
					<div class="col-sm-8"> 
						<input id="projectName" th:field="*{projectName}"  name="projectName"  class="form-control" type="text">
					</div>
				</div>
			</div>
			<div class="col-sm-12">
				<div class="form-group">
					<label class="col-sm-2 control-label">投标公告文件：</label>
					<div class="col-sm-6">
					    <div class="file-loading">
							<input id="uploadFileId" type="file" multiple>
						</div>
						<input id="fileUrl1" name="tenderDoc" class="form-control"
							type="hidden">	
						
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-offset-5 col-sm-10">
					<button type="button" class="btn btn-sm btn-info"
							onclick="save()" th:if="${jyTender.status=='99'}">
						<i class="fa fa-check"></i>保存草稿
					</button>

					<button type="button" class="btn btn-sm btn-info"
							onclick="submitHandlerDraft()" th:if="${jyTender.status=='99'}">
						<i class="fa fa-check"></i>提 交
					</button>
					<button th:unless="${jyTender.directTender=='Y'}" type="button" class="btn btn-sm btn-primary"
						onclick="submitHandler()" th:if="${jyTender.status=='3'}">
						<i class="fa fa-check"></i>提 交
					</button>

					<button th:if="${jyTender.directTender=='Y'}" type="button" class="btn btn-sm btn-primary"
							onclick="submitHandler1()">
						<i class="fa fa-check"></i>保 存
					</button>
					&nbsp;
					<button type="button" class="btn btn-sm btn-danger"
						onclick="closeItem()">
						<i class="fa fa-reply-all"></i>关 闭
					</button>
				</div>
			</div>
		</form>
	</div>
	<div th:include="include::footer"></div>
	<th:block th:include="include :: bootstrap-fileinput-js" />
	<script th:inline="javascript">
		var prefix = ctx + "business/jyTender";
		$("#form-jyTender-edit").validate({
			rules : {
				xxxx : {
					required : true,
				},
			},
			focusCleanup : true
		});
		$(function() {
			//图片反显出来
			var config = {
				url: ctx+"oa/oaAttachment/selectAttach",
				type: "post",
				dataType: "json",
				data: {"objectId": [[${jyTender.id}]],"sourceTable":"jy_tender"},
				success: function(result) {
					var imgsUrl = new Array();
					var attachList = result.data;
					if(attachList!=null && attachList.length>0){
						var downloadConfig = new Array();
						for(var i=0; i<attachList.length; i++){
							var down = {};
							var attach = attachList[i];
							imgsUrl.push(attach.attachmentUrl);
							down.key = attach.attachmentName;
							down.caption = attach.fileName;
							down.extra={"fileName" : attach.attachmentName,"tableName" : "oa_attachment"};//对象或者函数，通过POST方法传递给初始预览的删除url或者AJAX服务器响应的额外数据。如果没有设置，它将默认为deleteExtraData。
							if(isAssetTypeAnImage(attach.attachmentName)){
								down.type = 'image';
							}else{
								down.type = 'object';
							}
							downloadConfig.push(down);
							attachmentList.push({"objectId":[[${jyTender.id}]],"attachmentName":attach.attachmentName,"fileName":attach.fileName})
						}
						var option1={
							id:'uploadFileId',
							uploadUrl:null,
							deleteUrl:null,
							imgsUrl:imgsUrl,
							downloadConfig:downloadConfig
						}
						$.common.uploadFile(option1);
					}else{
						var option2={
							id:'uploadFileId',
							uploadUrl:null,
							deleteUrl:null,
							deleteExtraData:null,
							imgsUrl:new Array(),
							initialPreviewConfig:null
						}
						$.common.uploadFile(option2);
					}
				}
			};
			$.ajax(config)


		});
		var attachmentUrls = null;
		/* uploadFile('uploadFileId1', 'fileUrl1')
		function uploadFile(id,url) {
			//文件上传
			var attachmentUrls = null;
			$('#' + id).fileinput({
				'theme' : 'explorer-fas',
				uploadUrl : ctx + 'common/bootstrapFileInputUpload',
				overwriteInitial : false,
				initialPreviewAsData : true,
				uploadAsync : true
			/* initialPreview: [
			    "/img/profile.jpg"
			] */
			/* }).on("fileuploaded", function(event, data, previewId, index) {
				if (attachmentUrls == null) {
					attachmentUrls = data.response.fileName;
				} else {
					attachmentUrls += "," + data.response.fileName;
				}
				$("#" + url).val(attachmentUrls);
			});
		} */ 

		function submitHandler() {
			if ($.validate.form()) {
				var data = $('#form-jyTender-edit').serializeArray();
				data.push({"name": "tenderDoc", "value": attachmentUrls});
				$.operate.saveTab(prefix + "/edit", data);
			}
		}
		//禹涛直接买标的编辑保存
		function submitHandler1(){
			if ($.validate.form()) {
				var data = $('#form-jyTender-edit').serializeArray();
				data.push({"name": "tenderDoc", "value": attachmentUrls});
				$.operate.saveTab(prefix + "/ytEdit", data);
			}
		}
		//	保存草稿

		function save() {
			if ($.validate.form()) {
				var data = $('#form-jyTender-edit').serializeArray();
				data.push({"name": "tenderDoc", "value": attachmentUrls});
				$.operate.saveTab(prefix + "/saveDraft", data);
			}
		}
	//	提交草稿
		function submitHandlerDraft(){
			if ($.validate.form()) {
				var data = $('#form-jyTender-edit').serializeArray();
				data.push({"name": "tenderDoc", "value": attachmentUrls});
				$.operate.saveTab(prefix + "/submitDraft", data);
			}
		}
	</script>
</body>
</html>
